<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width" />
	<title>Cathy Chen</title>
	<link rel="stylesheet" href="css/style.css"/>
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Oswald:300' rel='stylesheet' type='text/css'>

</head>

<body>

	<a href="./index.html"><div id="back"><div id="back-arrow"></div>BACK</div></a>

	<div id="blind"></div>

	<!-- TEMPLATE FOR OVERLAY -->
	<!-- 
	<div id="overlay">
		<div id="right"></div>
		<div id="left"></div>
		<div id="details">
			<div id="head_img" style="background: url('temp-img/pic5.jpg')">
				<div id="date">MARCH 25</div>
				<div id="close"></div>
			</div>
			<div id="content">
				<div class="row">
					<div class="col-3 middle-side">
						<span>~</span>
					</div>
					<div class="col-3 middle">
						<span>
							Butternut Squash Soup
							<br>
							Soy-glazed Baked Salmon
							<br>
							Berry Custard Fruit Tart
						</span>
					</div>
					<div class="col-3 middle-side">
						<span>~</span>
					</div>
				</div>
				<div class="row" style="padding: 15px;">
					<div class="col-4 middle">
						<div class="person" style="background: url('temp-img/pic6.jpg')"></div>
						<div>Cathy Chen</div>
					</div>
					<div class="col-4 middle">
						<div class="person" style="background: url('temp-img/pic7.jpg')"></div>
						<div>Ben Hsu</div>
					</div>
					<div class="col-4 middle">
						<div class="person" style="background: url('temp-img/pic8.jpg')"></div>
						<div>Serena Tsay</div>
					</div>
					<div class="col-4 middle">
						<div class="person" style="background: url('temp-img/pic9.jpg')"></div>
						<div>Alexander Sands</div>
					</div>
				</div>
			</div>

		</div>
	</div> -->

	<div class="container outline">
		<div class="row">
			<div class="col-2" id="curr_month">
				MONTH
			</div>
			<div class="col-2" id="select_month">
				<div class="select_style">
					<select id="months">
						<option value="april">APRIL</option>
						<option value="march">MARCH</option>
					</select>
				</div>
			</div>
		</div>
		<div class="row" id="dates">

			<!-- TEMPLATE FOR DATE SELECTOR -->
			<!-- <div class="col-4">
				<div class="date_pic" style="background:linear-gradient(rgba(0, 0, 0, 0.6),rgba(0, 0, 0, 0.6)),url('temp-img/pic1.png');background-size: cover;">
					<div class="text">5</div>
				</div>
			</div>  -->
		</div> 
	</div>

</body>
<script async defer src="http://platform.instagram.com/en_US/embeds.js"></script>
<script src="https://code.jquery.com/jquery-2.2.2.min.js"></script>
<script>
	$(document).ready(function() {

		var curr_month = "april"
		var curr_num = 0

		$("#dates").empty();

		readCSV(curr_month);

		function readCSV(month) {
			$.ajax({
				type: "GET",
				url: "http://cathychen95.github.io/popup-static/" + month + "/info.txt",
				dataType: "text",
				success: function(data) {processData(data);}
			});
		}

		function processData(data) {
			var lines = data.split(/\r\n|\n/);
			var headers = lines[0].split(',');

			for (var i=1; i < lines.length; i++) {

				if (lines[i].length == 0) {
					continue;
				}

				var line = lines[i].split(',');
				cur_num = lines.length-2;


				var col = $("<div>").addClass("col-4");
				var date_pic = $("<div>").addClass("date_pic").attr("num", i);
				var text = $("<div>").addClass("text");

				var pic = date_pic.css("background", "linear-gradient(rgba(0, 0, 0, 0.6),rgba(0, 0, 0, 0.6)),url('https://instagram.com/p/" + line[9].trim() + "/media/?size=m')");
				var date_num = text.html(line[0]);
				$("#dates").append(col.append(date_pic.append(date_num)));


				var overlay = $("<div>").addClass("overlay").attr("num", i);
				var right = $("<div>").attr("id", "right");
				var left = $("<div>").attr("id", "left");
				var details = $("<div>").attr("id", "details");
				var head_img = $("<div>").attr("id", "head_img").css("background", "url('" + curr_month + "/" + line[0] + "/banner.jpg')");
				var date = $("<div>").attr("id", "date").html(curr_month.toUpperCase() + " " + line[0]);
				var close = $("<div>").addClass("close");
				var content = $("<div>").attr("id", "content");
				var row = $("<div>").addClass("row");
				var insta_link1 = "https://instagram.com/p/" + line[8].trim()
				var insta_link2 = "https://instagram.com/p/" + line[9].trim()
				var insta_link3 = "https://instagram.com/p/" + line[10].trim()
				var insta1 = $("<div>").addClass("col-3 middle-side").html("<a href=" + insta_link1 + " target='_blank'><div class='food' style='background: url(" + insta_link1 + "/media/?size=m)'></div></a>");
				var insta2 = $("<div>").addClass("col-3 middle-side").html("<a href=" + insta_link2 + " target='_blank'><div class='food' style='background: url(" + insta_link2 + "/media/?size=m)'></div></a>");
				var insta3 = $("<div>").addClass("col-3 middle-side").html("<a href=" + insta_link3 + " target='_blank'><div class='food' style='background: url(" + insta_link3 + "/media/?size=m)'></div></a>");
				var col_3_squig = $("<div>").addClass("col-3 middle-side").html("<span>~</span>");
				var col_3_squig_2 = $("<div>").addClass("col-3 middle-side").html("<span>~</span>");
				var col_3_middle = $("<div>").addClass("col-3 middle").html("<span>" + line[1] + "<br>" + line[2] + "<br>" + line[3] + "</span>");
				var pad_row = row.css("padding", "15px").append(
						$("<div>").addClass("col-4 middle").append($("<div>").addClass("person").css("background", "url('" + curr_month + "/" + line[0] + "/participant_" + 1 +".jpg')")).append("<div>" + line[4] + "</div>")
					).append(
						$("<div>").addClass("col-4 middle").append($("<div>").addClass("person").css("background", "url('" + curr_month + "/" + line[0] + "/participant_" + 2 +".jpg')")).append("<div>" + line[5] + "</div>")
					).append(
						$("<div>").addClass("col-4 middle").append($("<div>").addClass("person").css("background", "url('" + curr_month + "/" + line[0] + "/participant_" + 3 +".jpg')")).append("<div>" + line[6] + "</div>")
					).append(
						$("<div>").addClass("col-4 middle").append($("<div>").addClass("person").css("background", "url('" + curr_month + "/" + line[0] + "/participant_" + 4 +".jpg')")).append("<div>" + line[7] + "</div>")
					);

				// $("#blind").after(overlay.append(right).append(left).append(details.append(head_img.append(date).append(close)).append(content.append($("<div>").addClass("row").append(col_3_squig).append(col_3_middle).append(col_3_squig_2)).append(pad_row))))
				$("#blind").after(overlay.append(details.append(head_img.append(date).append(close)).append(content.append($("<div>").addClass("row").append(insta1).append(insta2).append(insta3)).append($("<div>").addClass("row").append(col_3_squig).append(col_3_middle).append(col_3_squig_2)).append(pad_row))))

			}

			$(".close").on("click", function() {
				console.log("clicked");
				$(".overlay").hide();
				$("#blind").hide();
			});

			$(".date_pic").on("click", function() {

				var num = $(this).attr("num");
				console.log("clicked");
				$(".overlay[num='" + num + "']").show();
				$("#blind").show();
			});
		}

		$("#months").change(function() {

			$("#dates").empty();
			$(".overlay").remove();
			curr_month = $(this).val();
			console.log($(this).val());
			readCSV($(this).val());
		});


		


	});
</script>

</html>